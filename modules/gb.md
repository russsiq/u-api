# uAPI модуля «Гостевая книга»

- [Материалы](#module-gb-entry)
- [Настройки полей](#module-gb-fields)

<a name="module-gb-entry"></a>
### Материалы

#### [GET] Все посты

> Обязательные параметры: отсутствуют

Пример запроса:

    $response = $request->get('/gb', array(
        // без параметров
    ));

Пример ответа:

    {
       "page":1,
       "pages":[
          1
       ],
       "per_page":10,
       "posts":[
          {
             "country":"russia",
             "answer":"",
             "pending":"no",
             "author_email":"email@email.com",
             "author":"myname",
             "message":"message",
             "state":"tatarstan",
             "add_date":"2014-11-26 01:42",
             "rate":1,
             "who_add":"",
             "icq":"1111",
             "city":"kazan",
             "url":"http://yoursite.ucoz.ru/gb",
             "id":3
          }
       ],
       "total_posts":1
    }

Расшифровка переменных:

- `page` – [Число] – Номер текущей страницы
- `per_page` – [Число] – Количество материалов на страницу
- `posts` – [Массив] – **О постах в модуле**
    - `country` – [Строка] – Страна автора поста
    - `answer` – [Строка] – Ответ на пост
    - `pending` – [Строка] – В ожидании ли активации данный пост (yes/no)
    - `author_email` – [Строка] – Email автора поста
    - `author` – [Строка] – Имя автора поста
    - `message` – [Строка] – Текст сообщения поста
    - `state` – [Строка] – Значение поля "Штаты"
    - `add_date` – [Строка] – Дата добавления поста
    - `rate` – [Строка] – Общий рейтинг поста
    - `who_add` – [Строка] – Никнейм автора поста
    - `icq` – [Строка] – Значение поля "ICQ"
    - `city` – [Строка] – Город автора поста
    - `url` – [Строка] – Значение поля "www"
    - `id` – [Строка] – ID поста
- `total_posts` – [Строка] – Общее количество постов в модуле

#### [POST] Добавить пост

> Обязательные параметры: `message`

Пример запроса:

    $response = $request->post('/gb', array(
        'message' => 'Мой отзыв об API из uCoz API'
    ));

Пример ответа:

    {
       "country":null,
       "pending":"no",
       "author_email":"",
       "author":null,
       "state":null,
       "message":"Мой отзыв об API из uCoz API",
       "who_add":"Dmitry",
       "city":null,
       "icq":"",
       "url":"",
       "id":7
    }

Расшифровка переменных:

- `country` – [Строка] – Страна автора поста
- `pending` – [Строка] – В ожидании ли активации данный пост (yes/no)
- `author_email` – [Строка] – Email автора поста
- `author` – [Строка] – Имя автора поста
- `state` – [Строка] – Значение поля "Штаты"
- `message` – [Строка] – Текст сообщения поста
- `who_add` – [Строка] – Никнейм автора поста
- `city` – [Строка] – Город автора поста
- `icq` – [Строка] – Значение поля "ICQ"
- `url` – [Строка] – Значение поля "www"
- `id` – [Строка] – ID поста

#### [PUT] Редактор поста

> Обязательные параметры: `id`

Пример запроса:

    $response = $request->put('/gb', array(
        'id' => '7',
        'message' => 'Мой измененный отзыв об API из uCoz API'
    ));

Пример ответа:

    {
       "country":"",
       "answer":"",
       "pending":"no",
       "author_email":null,
       "author":"Dmitry Kiselev",
       "state":"",
       "message":"Мой измененный отзыв об API из uCoz API",
       "who_add":"Dmitry",
       "city":"",
       "icq":"",
       "url":""
    }

Расшифровка переменных:

- `country` – [Строка] – Страна автора поста
- `answer` – [Строка] – Ответ на пост
- `pending` – [Строка] – В ожидании ли активации данный пост (yes/no)
- `author_email` – [Строка] – Email автора поста
- `author` – [Строка] – Имя автора поста
- `state` – [Строка] – Значение поля "Штаты"
- `message` – [Строка] – Текст сообщения поста
- `who_add` – [Строка] – Никнейм автора поста
- `who_add` – [Строка] – Никнейм автора поста
- `city` – [Строка] – Город автора поста
- `icq` – [Строка] – Значение поля "ICQ"
- `url` – [Строка] – Значение поля "www"

#### [DELETE] Удалить пост

> Обязательные параметры: `id`

Пример запроса:

    $response = $request->delete('/gb/posts', array(
        'id' => '3'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Материал удалён"
       }
    }

#### [POST] Оценить пост

> Обязательные параметры: `id`, `mark`

Пример запроса:

    $response = $request->post('/gb/rate', array(
        'id' => '3',
        'mark' => '2' // 1 – хороший пост, 2 – плохой пост
    ));

Пример ответа:

    {
       "msg":"Ваш голос засчитан"
    }

<a name="module-gb-fields"></a>
### Настройки полей

#### [GET] Настройки полей модуля

> Обязательные параметры: отсутствуют.
>
> Запрос показывает, какие поля доступны при добавлении и редактировании материала.

Особенности:

1. Ответ строится исходя из настроек в Панели управления: Гостевая книга – Настройки модуля – Поля для добавления материалов.

Пример запроса:

    $response = $request->get('/gb/fields', array(
        // без параметров
    ));

Пример ответа:

    [
       {
          "checked":"no",
          "name":"Страна"
       },
       {
          "checked":"yes",
          "name":"E-mail"
       },
       {
          "checked":"no",
          "name":"Город"
       },
       {
          "checked":"no",
          "name":"ICQ"
       },
       {
          "checked":"yes",
          "name":"WWW"
       },
       {
          "checked":"no",
          "name":"Штат"
       }
    ]

Расшифровка переменных ответа:

- `checked` – [Строка] – Доступно ли поле при добавлении/редактировании материала? (yes/no)
- `required` – [Строка] – Является ли поле при добавлении/редактировании материала обязательным? (yes/no)
- `name` – [Строка] – Название поля
