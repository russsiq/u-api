# uAPI модуля «Форум»

- [Сообщения и опросы](#module-forum-messages)
- [Форум и темы](#module-forum-forum)
- [Модераторские функции](#module-forum-moderfunc)

<a name="module-forum-messages"></a>
### Сообщения и опросы

#### [GET] Список сообщений

> Обязательные параметры: `id` (айди темы)

Пример запроса:

    $response = $request->get('/forum/posts', array(
        'id' => '9'
    ));

Пример ответа:

    {
       "topic":{
          "closed":"yes",
          "name":"Название темы",
          "author":"Dmitry_DM",
          "description":"Описание темы",
          "url":"http://yoursite.ucoz.ru/forum/2-9-1",
          "id":9,
          "ontop":"yes",
          "firstontop":"yes"
       },
       "page":1,
       "pages":"1",
       "per_page":"15",
       "posts":[
          {
             "add_date":"2015-01-22 03:17",
             "message_id":11,
             "subscribe":"no",
             "topic_id":9,
             "user":{
                "avatar":"http://2093175133.uid.me/avatar.jpg",
                "state":"Татарстан",
                "msn":"",
                "email":"dima@ucoz.net",
                "group":"Администраторы",
                "city":"Казань",
                "icq":"",
                "gender":null,
                "yahoo":"",
                "country":"Российская Федерация",
                "aol":"",
                "name":"Dmitry_DM",
                "full_name":"Dmitry Kiselev",
                "rankico":"http://s55558.ucoz.net/rnk/1/rank1.gif",
                "forum_posts":4,
                "home_page":"",
                "rank":"Рядовой"
             },
             "message":"Текст сообщения"
          },
          {
              //Сообщение 2
          },
          {
              //Сообщение 3
          }
       ],
       "total_posts":3
    }

Расшифровка переменных:

- `topic` – [Массив] – Информация о теме
    - `closed` – [Строка] – Закрыта ли тема для новых сообщений? (yes/no)
    - `name` – [Строка] – Новое название темы
    - `author` – [Строка] – Никнейм пользователя, который создал тему
    - `description` – [Строка] – Описание темы
    - `url` – [Строка] – Ссылка на тему
    - `id` – [Строка] – ID темы
    - `ontop` – [Строка] – Тема всегда сверху (yes/no)
    - `firstontop` – [Строка] – Первое сообщение темы сделать шапкой (показывать на всех страницах) (yes/no)
- `page` – [Число] – Номер текущей страницы
- `pages_list` – [Строка] – Список страниц с темами (переключатели)
- `per_page` – [Число] – Количество тем на страницу
- `posts` – [Массив] – Сообщения темы
    - `add_date` – [Строка] – Дата добавления сообщения
    - `message_id` – [Строка] – ID сообщения
    - `subscribe` – [Строка] – Включена ли подписка на ответы в теме? (yes/no)
    - `topic_id` – [Строка] – ID темы, куда был добавлен материал
    - `user` – [Массив] – Информация о пользователе, который добавил сообщение
        - `avatar` – [Строка] – Ссылка на аватар пользователя
        - `state` – [Строка] – Значение поля "Штаты"
        - `msn` – [Строка] – Значение поля "MSN"
        - `email` – [Строка] – Значение поля "Email пользователя"
        - `group` – [Массив] – Информация о группе пользователя
        - `city` – [Строка] – Город пользователя
        - `icq` – [Строка] – Значение поля "ICQ"
        - `gender` – [Строка] – Пол пользователя
        - `yahoo` – [Строка] – Значение поля "Yahoo"
        - `country` – [Строка] – Страна пользователя
        - `aol` – [Строка] – Значение поля "AOL"
        - `full_name` – [Строка] – Имя пользователя
        - `rankico` – [Строка] – Ссылка на иконку ранка пользователя
        - `forum_posts` – [Строка] – Количество добавленных сообщений в модуле "Форум"
        - `home_page` – [Строка] – Значение поля "Домашняя страница (вебсайт)"
        - `rank` – [Строка] – Текущий ранк пользователя
    - `message` – [Строка] – Текст сообщения
- `total_posts` – [Строка] – Общее количество сообщений в теме

#### [POST] Добавить сообщение

> Обязательные параметры: id (айди темы)

Расшифровка переменных:

- `message` – [Строка] – Текст сообщения
- `includehtml` – [Строка] – Разрешить HTML в сообщении (yes/no)
- `end2br` – [Строка] – Заменять переносы строки на html тег br (yes/no)
- `smiles` – [Строка] – Разрешены ли смайлы в теме? (yes/no)
- `signature` – [Строка] – Опция " Включить подпись" (yes/no)
- `forum` – [Массив] – О форуме
- `includehtml` – [Строка] – Разрешить HTML в сообщении (yes/no)
- `signature` – [Строка] – Опция " Включить подпись" (yes/no)
- `pages_list` – [Строка] – Список страниц с темами (переключатели)

#### [PUT] Редактировать сообщение

> Обязательные параметры: id (айди сообщения)

Пример запроса:

    $response = $request->put('/forum/posts', array(
        'id' => '11',
        'message' => 'Измененное сообщение из АПИ!'
    ));

Пример ответа:

    {
       "closed":"yes",
       "name":"Название темы",
       "smiles":"yes",
       "author":null,
       "description":"Описание темы",
       "message":"Измененное сообщение из АПИ!",
       "add_date":"2015-01-24 00:08",
       "end2br":"yes",
       "signature":"yes",
       "id":9,
       "ontop":"yes",
       "firstontop":"yes",
       "includehtml":"no"
    }

Расшифровка переменных:

- `closed` – [Строка] – Закрыта ли тема для новых сообщений? (yes/no)
- `name` – [Строка] – Новое название темы
- `smiles` – [Строка] – Разрешены ли смайлы в теме? (yes/no)
- `author` – [Строка] – Никнейм пользователя, который создал тему
- `description` – [Строка] – Описание темы
- `message` – [Строка] – Текст сообщения
- `add_date` – [Строка] – Дата добавления сообщения
- `end2br` – [Строка] – Заменять переносы строки на html тег br (yes/no)
- `signature` – [Строка] – Опция " Включить подпись" (yes/no)
- `id` – [Строка] – ID темы
- `ontop` – [Строка] – Тема всегда сверху (yes/no)
- `firstontop` – [Строка] – Первое сообщение темы сделать шапкой (показывать на всех страницах) (yes/no)
- `includehtml` – [Строка] – Разрешить HTML в сообщении (yes/no)

#### [DELETE] Удалить сообщение

> Обязательные параметры: id (айди сообщения)

Пример запроса:

    $response = $request->delete('/forum/posts', array(
        'id' => '2'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Сообщение удалено"
       }
    }

#### [GET] Опросы

> Обязательные параметры: id (айди форума)

Пример запроса:

    $response = $request->get('/forum/poll', array(
        'id' => '2'
    ));

Пример ответа:

    {
       "polls":[
          {
             "reads":1,
             "subscribe":"no",
             "forum_id":2,
             "name":"Новый опрос",
             "author":"Dmitry_DM",
             "description":"Описание опроса",
             "question":"Вопрос",
             "poll_id":13,
             "url":"http://yoursite.ucoz.ru/forum/2-13-1",
             "posts":0,
             "votes_sum":0,
             "id":16,
             "firstontop":"no",
             "ontop":"no",
             "answers":[
                {
                   "Ответ 1":0
                },
                {
                   "Ответ 2":0
                },
                {
                   "Ответ 3":0
                },
                {
                   "Ответ 4":0
                }
             ]
          }
       ],
       "page":1,
       "pages":"1",
       "per_page":"25",
       "total_polls":1,
       "forum":{
          "access":{
             "reply":[
                "Все группы"
             ],
             "add":[
                "Все группы"
             ],
             "read":[
                "Все группы"
             ]
          },
          "private":"no",
          "moderators":[
             "Dmitry_DM"
          ],
          "name":"Test forum",
          "rules":{
             "caption":"ref",
             "description":"fdsf"
          },
          "description":"Test forum description",
          "state":"Активен",
          "link2newmsg":"есть",
          "noincrement":"no",
          "url":"http://yoursite.ucoz.ru/forum/2",
          "noatall":"no",
          "link2nomsg":"есть",
          "id":2
       }
    }

Расшифровка переменных:

- `polls` – [Массив] – Опросы
    - `reads` – [Число] – Количество просмотров опроса (темы)
    - `subscribe` – [Строка] – Включена ли подписка на ответы в теме? (yes/no)
    - `forum_id` – [Число] – ID форума, где создана тема
    - `name` – [Строка] – Название темы
    - `author` – [Строка] – Никнейм пользователя, который создал тему
    - `description` – [Строка] – Описание темы
    - `question` – [Строка] – Название вопроса
    - `poll_id` – [Строка] – ID опроса (темы)
    - `url` – [Строка] – Ссылка на тему
    - `posts` – [Число] – Количество сообщений в теме
    - `votes_sum` – [Число] – Количество пользователей прогосовавших в опросе
    - `id` – [Строка] – ID темы
    - `firstontop` – [Строка] – Первое сообщение темы сделать шапкой (показывать на всех страницах) (yes/no)
    - `ontop` – [Строка] – Тема всегда сверху (yes/no)
    - `answers` – [Массив] – Возможные варианты ответа в опросе (Ответ – количество голосов)
- `page` – [Число] – Номер текущей страницы
- `pages_list` – [Строка] – Список страниц с темами (переключатели)
- `per_page` – [Число] – Количество тем на страницу
- `total_posts` – [Строка] – Общее количество сообщений в теме
- `forum` – [Массив] – О форуме
    - `access` – [Массив] – Доступ к форуму
        - `reply` – [Массив] – Какие группы имеют право добавлять ответы в темы
        - `add` – [Массив] – Какие группы имеют право создавать темы в темы форума
        - `read` – [Массив] – Какие группы имеют право читать темы форума
    - `private` – [Строка] – Установлен ли пароль для форума? (yes/no)
    - `moderators` – [Массив] – Массив никнеймов модераторов форума
    - `name` – [Строка] – Название форума
    - `rules` – [Массив] – Правила форума
        - `caption` – [Строка] – Заголовок правил форума
        - `description` – [Строка] – Текст правил форума
    - `description` – [Строка] – Описание форума
    - `state` – [Строка] – Текущий статус форума (Активен/Закрыт/Отключен)
    - `link2newmsg` – [Строка] – URL адрес иконки "Есть новые сообщения"
    - `noincrement` – [Строка] – Не прибавлять пользователям количество сообщений (yes/no)
    - `url` – [Строка] – Ссылка на форум
    - `noatall` – [Строка] – Темы форума не должны выводиться в ленточном варианте форума (yes/no)
    - `link2nomsg` – [Строка] – URL адрес иконки "Нет новых сообщений"
    - `id` – [Строка] – ID форума

#### [POST] Добавить опрос

> Обязательные параметры: `forum_id`, `name`, `message`, `answers`, `question`

Пример запроса:

    $response = $request->post('/forum/poll', array(
        'forum_id' => '2',
        'name' => 'Название опроса',
        'message' => 'Мое сообщение',
        'answers' => 'Первое|Второе|Третье',
        'question' => 'Мой вопрос',
    ));

Возможные параметры для передачи:

- `forum_id` – [Число] – ID форума, где необходимо создать опрос
- `name` – [Строка] – Название опроса
- `message` – [Строка] – Текст сообщения опроса
- `answers` – [answers] – Ответы в опросе. Перечисление происходит через знак `|`
- `question` – [Строка] – Вопрос опроса

Пример ответа:

    {
       "pollonly":"no",
       "author":"uAPI",
       "end2br":"yes",
       "add_date":"2015-02-15 23:32",
       "pollmulty":"no",
       "id":4,
       "ontop":"no",
       "answers":[
          "Первое",
          "Второе",
          "Третье"
       ],
       "closed":"no",
       "name":"Название опроса",
       "smiles":"yes",
       "description":null,
       "polltime":"unlimited",
       "message":"Мое сообщение",
       "question":"Мой вопрос",
       "signature":"yes",
       "includehtml":"yes",
       "firstontop":"no"
    }

#### [PUT] Изменить/Перенести опрос

> Обязательные параметры: `poll_id` (айди опроса)

Пример запроса:

    $response = $request->put('/forum/poll', array(
        'poll_id' => '13',
        'description' => 'Измененное описание',
        'name' => 'Изменил название..',
        'newforum_id' => '3'
    ));

Возможные параметры для передачи:

- `poll_id` – [Строка] – ID опроса (темы)
- `description` – [Строка] – Новое описание темы
- `name` – [Строка] – Новое название темы
- `newforum_id` – [Число] – ID форума, куда необходимо перенести тему

Пример ответа:

    {
       "success":{
          "msg":"Опрос 'Новый опрос' перенесён в новый форум 'Test'"
       }
    }

#### [DELETE] Удалить опрос

> Обязательные параметры: `poll_id` (айди опроса)

Пример запроса:

    $response = $request->delete('/forum/poll', array(
        'poll_id' => '13'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Тема удалена"
       }
    }

#### [GET] Результаты опроса

> Обязательные параметры: `poll_id` (айди опроса)

Пример запроса:

    $response = $request->get('/forum/poll/results', array(
        'poll_id' => '15'
    ));

Пример ответа:

    {
       "question":null,
       "poll_id":15,
       "expired":"24.01.2015",
       "all_answers":0
    }

<a name="module-forum-forum"></a>
### Форум и темы

#### [GET] Форумы

> Обязательные параметры: отсутствуют

Пример запроса:

    $response = $request->get('/forum', array(
        // без параметров
    ));

Пример ответа:

    [
       {
          "access":{
             "reply":[
                "Все группы"
             ],
             "add":[
                "Все группы"
             ],
             "read":[
                "Все группы"
             ]
          },
          "private":"yes",
          "moderators":[
             "Dmitry_DM"
          ],
          "name":"Test forum",
          "rules":{
             "caption":"ref",
             "description":"fdsf"
          },
          "description":"Test forum description",
          "state":"Активен",
          "link2newmsg":"есть",
          "noincrement":"yes",
          "url":"http://yoursite.ucoz.ru/forum/2",
          "noatall":"yes",
          "link2nomsg":"есть",
          "id":2
       },
       {
           //информация о втором форуме
       },
       {
           //информация о третьем форуме
       }
    ]

Расшифровка переменных:

- `access` – [Массив] – Доступ к форуму
    - `reply` – [Массив] – Какие группы имеют право добавлять ответы в темы
    - `add` – [Массив] – Какие группы имеют право создавать темы в темы форума
    - `read` – [Массив] – Какие группы имеют право читать темы форума
- `private` – [Строка] – Установлен ли пароль для форума? (yes/no)
- `moderators` – [Массив] – Массив никнеймов модераторов форума
- `name` – [Строка] – Название форума
- `rules` – [Массив] – Правила форума
    - `caption` – [Строка] – Заголовок правил форума
    - `description` – [Строка] – Текст правил форума
- `description` – [Строка] – Описание форума
- `state` – [Строка] – Текущий статус форума (Активен/Закрыт/Отключен)
- `link2newmsg` – [Строка] – URL адрес иконки "Есть новые сообщения"
- `noincrement` – [Строка] – Не прибавлять пользователям количество сообщений (yes/no)
- `url` – [Строка] – Ссылка на форум
- `noatall` – [Строка] – Темы форума не должны выводиться в ленточном варианте форума (yes/no)
- `link2nomsg` – [Строка] – URL адрес иконки "Нет новых сообщений"
- `id` – [Строка] – ID форума

#### [GET] Определенный форум

> Обязательные параметры:`id` (айди форума)

Пример запроса:

    $response = $request->get('/forum', array(
        'id' => 'АЙДИФОРУМА'
    ));

Пример ответа:

    [
       {
          "access":{
             "reply":[
                "Все группы"
             ],
             "add":[
                "Все группы"
             ],
             "read":[
                "Все группы"
             ]
          },
          "private":"yes",
          "moderators":[
             "Dmitry_DM"
          ],
          "name":"Test forum",
          "rules":{
             "caption":"ref",
             "description":"fdsf"
          },
          "description":"Test forum description",
          "state":"Активен",
          "link2newmsg":"есть",
          "noincrement":"yes",
          "url":"http://yoursite.ucoz.ru/forum/2",
          "noatall":"yes",
          "link2nomsg":"есть",
          "id":2
       }
    ]

Расшифровка переменных:

- `access` – [Массив] – Доступ к форуму
    - `reply` – [Массив] – Какие группы имеют право добавлять ответы в темы
    - `add` – [Массив] – Какие группы имеют право создавать темы в темы форума
    - `read` – [Массив] – Какие группы имеют право читать темы форума
- `private` – [Строка] – Установлен ли пароль для форума? (yes/no)
- `moderators` – [Массив] – Массив никнеймов модераторов форума
- `name` – [Строка] – Название форума
- `rules` – [Массив] – Правила форума
    - `caption` – [Строка] – Заголовок правил форума
    - `description` – [Строка] – Текст правил форума
- `description` – [Строка] – Описание форума
- `state` – [Строка] – Текущий статус форума (Активен/Закрыт/Отключен)
- `link2newmsg` – [Строка] – URL адрес иконки "Есть новые сообщения"
- `noincrement` – [Строка] – Не прибавлять пользователям количество сообщений (yes/no)
- `url` – [Строка] – Ссылка на форум
- `noatall` – [Строка] – Темы форума не должны выводиться в ленточном варианте форума (yes/no)
- `link2nomsg` – [Строка] – URL адрес иконки "Нет новых сообщений"
- `id` – [Строка] – ID форума

#### [GET] Список тем

> Обязательные параметры: id (айди форума)

Пример запроса:

    $response = $request->get('/forum/topic', array(
        // без параметров
    ));

Пример ответа:

    {
       "topics":[
          {
             "closed":"yes",
             "reads":1,
             "forum_id":"2",
             "name":"Название темы",
             "author":"Dmitry_DM",
             "description":"Описание темы",
             "url":"http://yoursite.ucoz.ru/forum/2-9-1",
             "id":"9",
             "posts":0,
             "firstontop":"yes",
             "ontop":"yes"
          },
          {
              //вторая тема
          },
          {
              //третья тема
          }
       ],
       "total_topics":1,
       "page":1,
       "pages":"1",
       "per_page":"25"
    }

Расшифровка переменных:

- `topics` – [Строка] – Информация о темах
    - `closed` – [Строка] – Закрыта ли тема для новых сообщений? (yes/no)
    - `reads` – [Число] – Количество просмотров темы
    - `forum_id` – [Число] – ID форума, где создана тема
    - `name` – [Строка] – Название темы
    - `author` – [Строка] – Никнейм пользователя, который создал тему
    - `description` – [Строка] – Описание темы
    - `url` – [Строка] – Ссылка на тему
    - `id` – [Строка] – ID темы
    - `posts` – [Число] – Количество сообщений в теме
    - `firstontop` – [Строка] – Первое сообщение темы сделать шапкой (показывать на всех страницах) (yes/no)
    - `ontop` – [Строка] – Тема всегда сверху (yes/no)
- `total_topics` – [Число] – Общее количество тем
- `page` – [Число] – Номер текущей страницы
- `pages_list` – [Строка] – Список страниц с темами (переключатели)
- `per_page` – [Число] – Количество тем на страницу

#### [POST] Добавить новую тему

> Обязательные параметры: `forum_id`, `name`, `message`

Пример запроса:

    $response = $request->post('/forum/topic', array(
        'forum_id' => '2',
        'name' => 'Название из API',
        'message' => 'Текст из API'
    ));

Пример ответа:

    {
       "closed":"no",
       "name":"Название из API",
       "smiles":"yes",
       "author":"Dmitry_DM",
       "description":null,
       "message":"Текст из API",
       "add_date":"2015-01-23 16:45",
       "end2br":"yes",
       "signature":"yes",
       "id":12,
       "ontop":"no",
       "firstontop":"no",
       "includehtml":"yes"
    }

Расшифровка переменных:

- `closed` – [Строка] – Закрыта ли тема для новых сообщений? (yes/no)
- `name` – [Строка] – Название темы
- `smiles` – [Строка] – Разрешены ли смайлы в теме? (yes/no)
- `author` – [Строка] – Никнейм пользователя, который создал тему
- `description` – [Строка] – Описание темы
- `message` – [Строка] – Текст темы
- `add_date` – [Строка] – Дата добавления темы
- `end2br` – [Строка] – Заменять переносы строки на html тег br (yes/no)
- `signature` – [Строка] – Опция " Включить подпись" (yes/no)
- `id` – [Строка] – ID темы
- `ontop` – [Строка] – Тема всегда сверху (yes/no)
- `firstontop` – [Строка] – Первое сообщение темы сделать шапкой (показывать на всех страницах) (yes/no)
- `firstontop` – [Строка] – Первое сообщение темы сделать шапкой (показывать на всех страницах) (yes/no)
- `includehtml` – [Строка] – Разрешить HTML в сообщении (yes/no)

#### [PUT] Изменить/Перенести тему

> Обязательные параметры: `topic_id`

Пример запроса:

    $response = $request->put('/forum/topic', array(
        'topic_id' => '12',
        'name' => 'Новое Название из API',
        'newforum_id' => '2'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }

    {
       "success":{
          "msg":"Тема 'Новое Название из API' перенесена в новый форум 'Test forum'"
       }
    }

Расшифровка переменных:

- `topic_id` – [Число] – ID темы
- `newforum_id` – [Число] – ID форума, куда необходимо перенести тему
- `name` – [Строка] – Новое название темы
- `description` – [Строка] – Новое описание темы

#### [DELETE] Удалить тему

> Обязательные параметры: `topic_id`

Пример запроса:

    $response = $request->delete('/forum/topic', array(
        'topic_id' => '12'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Тема удалена"
       }
    }

<a name="module-forum-moderfunc"></a>
### Модераторские функции

#### [POST] Переместить тему

> Обязательные параметры: `topic_id`, `newforum_id`

Пример запроса:

    $response = $request->post('/forum/topic/move', array(
        'topic_id' => '9',
        'newforum_id' => '3'
    ));

Передаваемые данные:

- `topic_id` – [Строка] – ID темы, которую необходимо перенести
- `newforum_id` – [Строка] – ID форума, куда следует перенести тему

Пример ответа:

    {
       "success":{
          "msg":"Тема 'Название темы' перенесена в новый форум 'Test'"
       }
    }

#### [POST] Закрыть тему

> Обязательные параметры: `topic_id`

Пример запроса:

    $response = $request->post('/forum/topic/close', array(
        'topic_id' => '9'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }

#### [DELETE] Удалить тему

> Обязательные параметры: `topic_id`

Пример запроса:

    $response = $request->delete('/forum/topic', array(
        'topic_id' => '9'
    ));

Пример ответа:

    {
        "success":{
                "msg":"Тема удалена"
        }
    }

#### [POST] Опустить тему

> Обязательные параметры: `thread_id`

Пример запроса:

    $response = $request->post('/forum/topic/down', array(
        'thread_id' => '9'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }

#### [POST] Зафиксировать тему

> Обязательные параметры: `thread_id`

Пример запроса:

    $response = $request->post('/forum/topic/ontop', array(
        'thread_id' => '9'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }

#### [POST] Опустить 1-ое сообщение

> Обязательные параметры: `thread_id`

Пример запроса:

    $response = $request->post('/forum/topic/down', array(
        'thread_id' => '9'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }

#### [POST] Зафиксировать 1-ое сообщение

> Обязательные параметры: `thread_id`

Пример запроса:

    $response = $request->post('/forum/topic/ontop', array(
        'thread_id' => '9'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }

#### [POST] Соединить тему

> Обязательные параметры: `thread_id`

Пример запроса:

    $response = $request->post('/forum/topic/ontop', array(
        'thread_id' => '9'
    ));

Пример ответа:

    {
       "success":{
          "msg":"Изменения сохранены"
       }
    }
